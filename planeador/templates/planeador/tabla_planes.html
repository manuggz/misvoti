{% extends 'misvoti/base.html' %}
{% block content %}
    <!-- Page Heading -->
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">
                Lista de Planes
            </h1>
            <ol class="breadcrumb">
                <li class="active">
                    <i class="fa fa-table"></i> Planes
                </li>
            </ol>
        </div>
    </div>
    <!-- /.row -->

    <div class="row">
        <div class="col-md-12">
            <h2 style="display: inline-block;">Planes Creados</h2>
            <a href="{% url 'crear_plan' %}" class="btn btn-primary" role="button" style="margin-left: 10px;">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                Crear Nuevo Plan
            </a>
            <hr>
            {%  for plan in planes %}
                <div class="panel panel-primary">
                  <div class="panel-heading">
                    <h3 class="panel-title"> <strong> Nombre del plan:</strong> {{ plan.nombre }}</h3>
                  </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-3">
                                <strong>Indice Acumulado:</strong> {{ plan.datos.indice }}
                            </div>
                            <div class="col-md-3">
                                <strong>Retiros:</strong> {{ plan.datos.n_retiros }}
                            </div>
                            <div class="col-md-3">
                                <strong>Trimestres:</strong> {{ plan.datos.n_trimestres }}
                            </div>
                            <div class="col-md-3">
                                <strong>Creditos Inscritos:</strong> {{ plan.datos.creds_inscri }}
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer">
                         <a href="{% url 'ver_plan' plan.nombre %}" role="button">Modificar</a>
                        <button type="button" class="btn btn-link" data-toggle="modal" data-target="#modal-eliminar-plan"  data-nombreplan = "{{ plan.nombre }}">Eliminar</button>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- /.row -->

    <!-- Modal de eliminar plan -->
    <div class="modal fade" tabindex="-1"  id="modal-eliminar-plan" role="dialog" aria-labelledby="mySmallModalLabel">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"></h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btn-eliminar-plan">Eliminar</button>
            </div>
        </div>
      </div>
    </div>
{% endblock %}

{% block final_pagina_scripts %}
    <script>

        $("a[data-toggle='dropdown']").click(function(){
            $("#tr_" + $(this).attr("data-nombreplan")).addClass("active");
        });
        $("tr").mouseleave(function(){
            $(this).removeClass("active");
        });

        var modal_eliminar = $('#modal-eliminar-plan');
        var button_trigger;
        var nombre_plan_eliminar;

        modal_eliminar.on('show.bs.modal', function (event) {
            button_trigger = $(event.relatedTarget); // Button that triggered the modal
            nombre_plan_eliminar = button_trigger.data('nombreplan'); // Extract info from data-* attributes

            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            modal_eliminar.find('.modal-title').text('¿Eliminar plan: "' + nombre_plan_eliminar + '" ?');

        });
        modal_eliminar.find('#btn-eliminar-plan').click(function (event) {
            var pannel_plan = button_trigger.closest("div.panel");
            $.post({% url 'eliminar_plan_ajax' %},{
                nombre_plan: nombre_plan_eliminar,
                },function(data, status){
                    if (status == "success"){
                        modal_eliminar.modal("hide");
                        pannel_plan.hide('slow', function(){ pannel_plan.remove(); });
                    }else{
                        alert("Ocurrió un error eliminando el plan");
                    }
                }
            );
        });

     </script>
{% endblock %}